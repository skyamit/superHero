<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="/style.css">

    <title>SuperHero Hunter </title>
  </head>
  <body class="background" id="body">
    <div>
      <header>
        <nav class="navbar navbar-light bg-light justify-content-between">
          <a class="navbar-brand" href="/"><b>Marvel</b></a>
          <a class="navbar-brand" id="bookmarked_heros" href="./bookmark.html"><b>Bookmarked</b></a>
          <form class="form-inline">
            <input  id="search" class="form-control mr-sm-2" type="search" placeholder="Enter Hero Name.." aria-label="Search">
            <button id="submit" class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
          </form>
        </nav>
      </header>
        <div id="heros" class="grid p-2" >
          
        </div>
    </div?>
    <script src="/toast.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js"></script>
    <script src="https://requirejs.org/docs/release/2.3.5/minified/require.js"></script>
    <script >
        var ts = CryptoJS.MD5(Date.now().toString());
        var publicKey = "4e5eab3e766f2717bd00c5721f841689";
        var privateKey = "63e6e43c0eb00694b0782ca23fe3f5315374fcbe";
        var hash = CryptoJS.MD5(ts + privateKey + publicKey);
        async function fn(){
            var array = JSON.parse(localStorage.getItem("bookmarked_hero"));

            var heros = document.getElementById("heros");
            heros.innerHTML = "";
            var offset = 100;
            var limit = 100;
            if(array.length == 0){
                new Toast("No Heros Bookmarked.. ",ToastType.Succes,1000);
                return;
            }
            new Toast("Loading... ",ToastType.Succes,1000);
            for( var id of array) {
                var charactersApi = "https://gateway.marvel.com:443/v1/public/characters/"+id+"?"+ts+"&apikey="+publicKey+"&hash="+hash;
                var res2 = await fetch(charactersApi).then(response => response.json());
                var data2 = res2.data.results;
                var d = data2[0];
                var url = d.urls;
                var thumbnail = d.thumbnail;
                var img = thumbnail.path + '.' + thumbnail.extension;
                if(img.includes("image_not_available") || img.includes("4c002e0305708")){
                    continue;
                }
                var title = d.name;
                heros.innerHTML += '<div class="card details" style="width: 20rem; padding:10px">' + 
                    '<img class="card-img-top" src="'+img+'" alt="Card image cap"> '+
                    '<div class="card-body"> '+
                    '<h5 class="card-title">'+title+'</h5> '+
                    '</div> '+
                    '<ul class="list-group list-group-flush">'+
                    '<li class="list-group-item" name="bookmark" id="'+d.id+'">Remove Bookmark!</li>'+
                    '<li class="list-group-item"><a href='+url[0].url+' target="_blank" >Know More</a></li>'+
                    '</ul>'+
                '</div>';
            }
        }
        fn();


        heros.addEventListener("click",function(e) {
            new Toast("Removing.. ",ToastType.Succes,1000);
            var target = e.target
            if (target.getAttribute("name") === "bookmark"){
                var id = target.getAttribute("id");
                
                var array = JSON.parse(localStorage.getItem("bookmarked_hero"));
                removeElement(array, id);
                localStorage.setItem("bookmarked_hero", JSON.stringify(array))

                fn();
            }
        });

        const removeElement = (arr, element) => {
            if(arr.indexOf(element) !== -1){
                arr.splice(arr.indexOf(element), 1);
                return ;
            };
        };

    </script>
  </body>
</html>